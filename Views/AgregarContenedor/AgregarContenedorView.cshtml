@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@using Syncfusion.EJ2
@using Syncfusion.EJ2.Lists
@using Syncfusion.EJ2.Inputs;
@using Syncfusion.EJ2;
@{ var templateSensor = "<div><img class='eimg' src='../Content/avatar/images/image_sensor${Code}.jpg' /><div class='ename'> ${Name} </div></div>";}
@using ProyectoAlmaInicio.Models;
@using Syncfusion.EJ2.DropDowns;
@using Syncfusion.EJ2.Navigations;
@model ProyectoAlmaInicio.Controllers.ServicioController.TextBoxModal

<div class="main-content e-responsive" id="main-text">
    <div class="sidebar-content sidebar">

        <div class="col-lg-12 control-section toast-default-section" hidden>
            <div class="control_wrapper">
                @Html.EJS().Toast("toast_type").Position(p => p.X("Right")).TimeOut(5000).Close("onclose").Created("created").BeforeOpen("onBeforeOpen").Render()
                <div id="toast_types">
                    <div>
                        @Html.EJS().Button("info_Toast").CssClass("e-btn e-control e-info").Content("Info Message").Render()
                        @Html.EJS().Button("success_Toast").CssClass("e-btn e-contro e-success").Content("Success Message").Render()
                        @Html.EJS().Button("warning_Toast").CssClass("e-btn e-control e-warning").Content("Warning Message").Render()
                        @Html.EJS().Button("error_Toast").CssClass("e-btn e-control e-danger").Content("Danger Message").Render()
                    </div>
                    <div style="padding-top: 15px">
                        @Html.EJS().Button("hideToast").CssClass("e-btn e-control").Content("Hide All").Render()
                    </div>
                </div>
            </div>
        </div>

        <h4 class="h4 tr" key="agregarContenedorSensor">AGREGAR CONTENEDOR/SENSOR</h4>
        <div class="col-xs-12 col-sm-12 col-lg-12 col-md-12">
            @using (Html.BeginForm("AgregarServicio", "Servicio", FormMethod.Post, new { id = "form_agregar" }))
            {
                @Html.ValidationSummary(true)
                <div class="col-lg-12 control-section">
                    <div id="wrapper" style="margin-top: 20px;">
                        <h5 class="h5 tr" key="datosContenedor">DATOS DEL CONTENEDOR</h5>
                        <hr style="border-width: medium;" />
                        <div class="alert alert-info row">
                            <i class="glyphicon glyphicon-info-sign fa-2x" style="vertical-align:middle;"></i>
                            <span style="vertical-align:middle;" class="tr" key="camposObligatorios">Los campos que poseen un (*) son obligatorios.</span>
                        </div>
                        <div class="div1">
                            <div class="row div-row">
                                <div id="div-destinatario" class="col-xs-6 col-sm-6 col-lg-6 col-md-6">
                                    <input type="text" id="destinatario" />
                                </div>
                                <div class="col-xs-6 col-sm-6 col-lg-6 col-md-6">
                                </div>
                            </div>

                            <div class="row div-row">
                                <div id="div-contenedor_agregar" class="col-xs-6 col-sm-6 col-lg-6 col-md-6">
                                    @*@Html.EJS().ComboBox("contenedor_agregar").Placeholder("Seleccione un contenedor").AllowFiltering(true).Filtering("onfilteringContenedor_agregar").Change("contenedorChange_agregar").DataSource((IEnumerable<object>)ViewBag.lista_contenedores).NoRecordsTemplate("<div>"
                                        + "<div id=\"nodata-contenedor_agregar\"> El contenedor ingresado no existe, ¿Desea agregarlo?</div><br />"
                                        + "<button id=\"btn-contenedor_agregar\" class=\"e-control e-btn\"> Agregar contenedor</button></div>").Fields(new ComboBoxFieldSettings { Text = "Name", Value = "Code" }).Render()*@
                                    @Html.EJS().TextBoxFor(model => model.contenedor_agregar).Placeholder("Número de Contenedor (*)").FloatLabelType(FloatLabelType.Auto).Render()
                                </div>
                                <div class="col-xs-6 col-sm-6 col-lg-6 col-md-6">
                                    <br />
                                    <input id="btn-validar_contenedor" type="button" class="btn btn-success tr" value="Validar" key="botonValidar">
                                </div>
                                <div hidden>
                                    @Html.EJS().TextBoxFor(model => model.servicio_app_servicios_agregar).Render()
                                </div>
                            </div>
                            <div class="row div-row">
                                <div id="div-origen_agregar" class="col-xs-6 col-sm-6 col-lg-6 col-md-6">
                                    @*@Html.EJS().TextBoxFor(model => model.lugar_origen_agregar).Placeholder("").FloatLabelType(FloatLabelType.Auto).Change("origenChange_agregar").Enabled(false).Render()*@

                                    @Html.EJS().ComboBox("lugar_origen_agregar").Placeholder("Lugar de Origen (*)").FloatLabelType(FloatLabelType.Auto).AllowFiltering(true).Filtering("onfilteringLugarOrigen_agregar").DataSource((IEnumerable<object>)ViewBag.lista_puertosorigen).NoRecordsTemplate("<div>"
                                + "<div id=\"nodata-lugarorigen_agregar\"> El puerto ingresado no existe, ¿Desea agregar una dirección diferente?</div><br />"
                                + "<button id=\"btn-lugarorigen_agregar\" class=\"e-control e-btn\">Agregar lugar</button></div>").Fields(new ComboBoxFieldSettings { Text = "Name", Value = "Name" }).Enabled(false).Render()

                                </div>

                                <div id="div-destino_agregar" class="col-xs-6 col-sm-6 col-lg-6 col-md-6">
                                    @*@Html.EJS().TextBoxFor(model => model.lugar_destino_agregar).Placeholder("Lugar de Destino (*)").FloatLabelType(FloatLabelType.Auto).Change("destinoChange_agregar").Enabled(false).Render()*@

                                    @Html.EJS().ComboBox("lugar_destino_agregar").Placeholder("Lugar de Destino (*)").FloatLabelType(FloatLabelType.Auto).AllowFiltering(true).Filtering("onfilteringLugarDestino_agregar").DataSource((IEnumerable<object>)ViewBag.lista_puertosdestino).NoRecordsTemplate("<div>"
                                + "<div id=\"nodata-lugardestino_agregar\"> El puerto ingresado no existe, ¿Desea agregar una dirección diferente?</div><br />"
                                + "<button id=\"btn-lugardestino_agregar\" class=\"e-control e-btn\">Agregar lugar</button></div>").Fields(new ComboBoxFieldSettings { Text = "Name", Value = "Name" }).Enabled(false).Render()
                                </div>
                            </div>

                            <div class="row div-row">
                                <div id="div-etd_agregar" class="col-xs-6 col-sm-6 col-lg-6 col-md-6">
                                    @Html.EJS().DatePicker("etd_agregar").Placeholder("ETD Nave (*)").FloatLabelType(FloatLabelType.Auto).Format("dd/MM/yyyy").Enabled(false).Render()
                                </div>
                                <div id="div-eta_agregar" class="col-xs-6 col-sm-6 col-lg-6 col-md-6">
                                    @Html.EJS().DatePicker("eta_agregar").Placeholder("ETA POD (*)").FloatLabelType(FloatLabelType.Auto).Format("dd/MM/yyyy").Enabled(false).Render()
                                </div>
                            </div>
                            <div class="row div-row">
                                <div class="col-xs-6 col-sm-6 col-lg-6 col-md-6">
                                    @Html.EJS().TextBoxFor(model => model.booking_agregar).Placeholder("Booking").FloatLabelType(FloatLabelType.Auto).Enabled(false).Render()
                                    <div>
                                        @Html.ValidationMessageFor(model => model.booking_agregar)
                                    </div>
                                </div>
                                <div class="col-xs-6 col-sm-6 col-lg-6 col-md-6">
                                    @Html.EJS().ComboBox("nave_agregar").Placeholder("Nave").FloatLabelType(FloatLabelType.Auto).AllowFiltering(true).DataSource((IEnumerable<object>)ViewBag.lista_naves).Fields(new ComboBoxFieldSettings { Text = "Name", Value = "Code" }).Enabled(false).Render()
                                </div>
                            </div>
                            <div class="row div-row">
                                <div class="col-xs-6 col-sm-6 col-lg-6 col-md-6">
                                    @Html.EJS().ComboBox("commodity_agregar").Placeholder("Commodity").FloatLabelType(FloatLabelType.Auto).AllowFiltering(true).Filtering("onfilteringCommodity_agregar").DataSource((IEnumerable<object>)ViewBag.lista_commodities).NoRecordsTemplate("<div>"
                                + "<div id=\"nodata-commodity_agregar\"> El commodity ingresado no existe, ¿Desea agregarlo?</div><br />"
                                + "<button id=\"btn-commodity_agregar\" class=\"e-control e-btn\">Agregar commodity</button></div>").Fields(new ComboBoxFieldSettings { Text = "Name", Value = "" }).Enabled(false).Render()
                                </div>
                                <div class="col-xs-6 col-sm-6 col-lg-6 col-md-6">
                                    @Html.EJS().ComboBox("naviera_agregar").Placeholder("Naviera").FloatLabelType(FloatLabelType.Auto).AllowFiltering(true).DataSource((IEnumerable<object>)ViewBag.lista_navieras).Fields(new ComboBoxFieldSettings { Text = "Name", Value = "Code" }).Enabled(false).Render()
                                </div>
                            </div>
                            <div class="row div-row">
                                <div class="col-xs-6 col-sm-6 col-lg-6 col-md-6">
                                    @*@Html.EJS().ComboBox("setpoint_co2_agregar").Placeholder("Setpoint CO2 (%)").AllowFiltering(true).Filtering("onfilteringSetpointCO2_agregar").DataSource((IEnumerable<object>)ViewBag.lista_setpoint_co2).NoRecordsTemplate("<div>"
                                        + "<div id=\"nodata-setpoint-co2_agregar\"> El setpoint de CO2 ingresado no existe, ¿Desea agregarlo?</div><br />"
                                        + "<button id=\"btn-setpoint-co2_agregar\" class=\"e-control e-btn\">Agregar setpoint CO2</button></div>").Fields(new ComboBoxFieldSettings { Text = "Name", Value = "Code" }).Enabled(false).Render()*@
                                    @Html.EJS().TextBoxFor(model => model.setpoint_co2_agregar).Placeholder("Setpoint CO2 (%)").Change("changeSP_CO2").FloatLabelType(FloatLabelType.Auto).Enabled(false).Render()
                                    <div>
                                        @Html.ValidationMessageFor(model => model.setpoint_co2_agregar)
                                    </div>
                                </div>
                                <div class="col-xs-6 col-sm-6 col-lg-6 col-md-6">
                                    @*@Html.EJS().ComboBox("setpoint_temp_agregar").Placeholder("Setpoint Temperatura (°C)").AllowFiltering(true).Filtering("onfilteringSetpointTemp_agregar").DataSource((IEnumerable<object>)ViewBag.lista_setpoint_temp).NoRecordsTemplate("<div>"
                                        + "<div id=\"nodata-setpoint-temp_agregar\"> El setpoint de temperatura ingresado no existe, ¿Desea agregarlo?</div><br />"
                                        + "<button id=\"btn-setpoint-temp_agregar\" class=\"e-control e-btn\">Agregar setpoint temperatura</button></div>").Fields(new ComboBoxFieldSettings { Text = "Name", Value = "Code" }).Enabled(false).Render()*@
                                    @Html.EJS().TextBoxFor(model => model.setpoint_temp_agregar).Placeholder("Setpoint Temperatura (°C)").Change("changeSP_Temp").FloatLabelType(FloatLabelType.Auto).Enabled(false).Render()
                                    <div>
                                        @Html.ValidationMessageFor(model => model.setpoint_temp_agregar)
                                    </div>
                                </div>
                            </div>
                            <div class="row div-row">
                                <div class="col-xs-6 col-sm-6 col-lg-6 col-md-6">
                                    @Html.EJS().TextBoxFor(model => model.descripcion_agregar).Placeholder("Descripción").FloatLabelType(FloatLabelType.Auto).Enabled(false).Render()
                                    <div>
                                        @Html.ValidationMessageFor(model => model.descripcion_agregar)
                                    </div>
                                </div>
                                @*<div class="col-xs-6 col-sm-6 col-lg-6 col-md-6">
                                        <br />
                                        <div class="col-xs-4 col-sm-4 col-lg-4 col-md-4">
                                            <label>Asignar y programar sensores al contenedor?</label>
                                        </div>
                                        <div class="col-xs-2 col-sm-2 col-lg-2 col-md-2">
                                            @Html.EJS().RadioButton("rb_si").Label("SI").Name("Seleccion").Value("SI").Render()
                                            @Html.EJS().RadioButton("rb_no").Label("NO").Name("Seleccion").Value("NO").Checked(true).Render()
                                        </div>

                                    </div>*@
                            </div>
                            <br />

                        </div>
                        <br />

                        <h5 class="h5 tr" key="AsignarYProgramarSensores">ASIGNAR Y PROGRAMAR SENSORES</h5>
                        <hr style="border-width: medium;" />
                        <div id="div_seccion_sensores" class="div_seccion_sensores">

                            <div id="div_sensores1" class="row" hidden="hidden" style="margin-bottom: 10px">
                                <div id="div-numero-serie_agregar1" class="col-xs-6 col-sm-6 col-lg-6 col-md-6">
                                    @Html.EJS().TextBoxFor(model => model.numero_serie_agregar).Placeholder("Número de Serie (*)").FloatLabelType(FloatLabelType.Auto).Change("numeroSerieChange_agregar").Render()
                                </div>
                                <div id="div-tipo-sensor_agregar1" class="col-xs-6 col-sm-6 col-lg-6 col-md-6">
                                    @Html.EJS().ComboBox("sensores_agregar").ItemTemplate(templateSensor).Change("sensoresChange_agregar").Placeholder("Tipo de Sensor (*)").FloatLabelType(FloatLabelType.Auto).DataSource((IEnumerable<object>)ViewBag.lista_sensores).Fields(new ComboBoxFieldSettings { Text = "Name", Value = "Code", HtmlAttributes = "Pic" }).Render()
                                </div>
                                <div class="col-xs-12 col-sm-12 col-lg-12 col-md-12">
                                    @Html.ValidationMessageFor(model => model.numero_serie_agregar)
                                </div>
                            </div>

                            <div id="div_sensores2" class="row" hidden="hidden" style="margin-bottom: 10px">
                                <div id="div-numero-serie_agregar2" class="col-xs-6 col-sm-6 col-lg-6 col-md-6">
                                    @Html.EJS().TextBoxFor(model => model.numero_serie_agregar2).Placeholder("Número de Serie").FloatLabelType(FloatLabelType.Auto).Change("numeroSerieChange_agregar").Render()
                                </div>
                                <div id="div-tipo-sensor_agregar2" class="col-xs-6 col-sm-6 col-lg-6 col-md-6">
                                    @Html.EJS().ComboBox("sensores_agregar2").ItemTemplate(templateSensor).Change("sensoresChange_agregar2").Placeholder("Tipo de Sensor").FloatLabelType(FloatLabelType.Auto).DataSource((IEnumerable<object>)ViewBag.lista_sensores).Fields(new ComboBoxFieldSettings { Text = "Name", Value = "Code" }).Render()
                                </div>
                                <div class="col-xs-12 col-sm-12 col-lg-12 col-md-12">
                                    @Html.ValidationMessageFor(model => model.numero_serie_agregar2)
                                </div>
                            </div>

                            <div id="div_sensores3" class="row" hidden="hidden" style="margin-bottom: 10px">
                                <div id="div-numero-serie_agregar3" class="col-xs-6 col-sm-6 col-lg-6 col-md-6">
                                    @Html.EJS().TextBoxFor(model => model.numero_serie_agregar3).Placeholder("Número de Serie").FloatLabelType(FloatLabelType.Auto).Change("numeroSerieChange_agregar").Render()
                                </div>
                                <div id="div-tipo-sensor_agregar3" class="col-xs-6 col-sm-6 col-lg-6 col-md-6">
                                    @Html.EJS().ComboBox("sensores_agregar3").ItemTemplate(templateSensor).Change("sensoresChange_agregar3").Placeholder("Tipo de Sensor").FloatLabelType(FloatLabelType.Auto).DataSource((IEnumerable<object>)ViewBag.lista_sensores).Fields(new ComboBoxFieldSettings { Text = "Name", Value = "Code" }).Render()
                                </div>
                                <div class="col-xs-12 col-sm-12 col-lg-12 col-md-12">
                                    @Html.ValidationMessageFor(model => model.numero_serie_agregar3)
                                </div>
                            </div>

                            <div id="div_sensores4" class="row" hidden="hidden" style="margin-bottom: 10px">
                                <div id="div-numero-serie_agregar4" class="col-xs-6 col-sm-6 col-lg-6 col-md-6">
                                    @Html.EJS().TextBoxFor(model => model.numero_serie_agregar4).Placeholder("Número de Serie").FloatLabelType(FloatLabelType.Auto).Change("numeroSerieChange_agregar").Render()
                                </div>
                                <div id="div-tipo-sensor_agregar4" class="col-xs-6 col-sm-6 col-lg-6 col-md-6">
                                    @Html.EJS().ComboBox("sensores_agregar4").ItemTemplate(templateSensor).Change("sensoresChange_agregar4").Placeholder("Tipo de Sensor").FloatLabelType(FloatLabelType.Auto).DataSource((IEnumerable<object>)ViewBag.lista_sensores).Fields(new ComboBoxFieldSettings { Text = "Name", Value = "Code" }).Render()
                                </div>
                                <div class="col-xs-12 col-sm-12 col-lg-12 col-md-12">
                                    @Html.ValidationMessageFor(model => model.numero_serie_agregar4)
                                </div>
                            </div>

                            <div id="div_sensores5" class="row" hidden="hidden" style="margin-bottom: 10px">
                                <div id="div-numero-serie_agregar5" class="col-xs-6 col-sm-6 col-lg-6 col-md-6">
                                    @Html.EJS().TextBoxFor(model => model.numero_serie_agregar5).Placeholder("Número de Serie").FloatLabelType(FloatLabelType.Auto).Change("numeroSerieChange_agregar").Render()
                                </div>
                                <div id="div-tipo-sensor_agregar5" class="col-xs-6 col-sm-6 col-lg-6 col-md-6">
                                    @Html.EJS().ComboBox("sensores_agregar5").ItemTemplate(templateSensor).Change("sensoresChange_agregar5").Placeholder("Tipo de Sensor").FloatLabelType(FloatLabelType.Auto).DataSource((IEnumerable<object>)ViewBag.lista_sensores).Fields(new ComboBoxFieldSettings { Text = "Name", Value = "Code" }).Render()
                                </div>
                                <div class="col-xs-12 col-sm-12 col-lg-12 col-md-12">
                                    @Html.ValidationMessageFor(model => model.numero_serie_agregar5)
                                </div>
                            </div>

                            <input id="btn-agregar-sensor" type="button" class="btn btn-success tr" key="botonAgregarSensor" value="Agregar Nuevo Sensor" />
                            <input id="btn-eliminar-sensor" type="button" class="btn btn-danger tr" key="botonEliminar" value="Eliminar Sensor" />

                        </div>
                        <br />

                        <div id="submitbutton" align="center">
                            <input id="btn-guardar_agregar" class="e-control e-btn e-success tr" key="botonGuardar" type="button" value="Guardar">
                            <input id="btn-editar_agregar" class="e-control e-btn e-success tr" key="botonEditar" type="button" value="Guardar Cambios" style="display:none">
                            <input id="btn-limpiar_agregar" class="e-control e-btn e-lib tr" key="botonLimpiar" type="button" value="Limpiar">
                        </div>
                    </div>
                </div>
            }
        </div>

    </div>
</div>

<script type="text/javascript">


    var lang = getCookie("Lenguaje");

    document.addEventListener('DOMContentLoaded', function () {
        loadCultureFiles(lang);
        datepicker = document.getElementById('etd_agregar').ej2_instances[0];
        datepicker2 = document.getElementById('eta_agregar').ej2_instances[0];
        console.log(datepicker);
        datepicker.locale = lang;
        datepicker2.locale = lang;
    });

    function loadCultureFiles(name) {
        var files = ['ca-gregorian.json', 'numbers.json', 'timeZoneNames.json'];
        if (name === 'ar') {
            files.push('numberingSystems.json');
        }
        var loader = ej.base.loadCldr;
        var loadCulture = function (prop) {
            var val, ajax;
            if (name === 'ar' && prop === files.length - 1) {
                ajax = new ej.base.Ajax(location.origin + location.pathname + '/../../ProyectoAlma/build/node_modules/cldr-data/supplemental/' + files[prop], 'GET', false);
            } else {
                ajax = new ej.base.Ajax(location.origin + location.pathname + '/../../ProyectoAlma/build/node_modules/cldr-data/main/' + name + '/' + files[prop], 'GET', false);
            }
            ajax.onSuccess = function (value) {
                val = value;
            };
            ajax.send();
            loader(JSON.parse(val));
        };
        for (var prop = 0; prop < files.length; prop++) {
            loadCulture(prop);
        }
    }




    var toast_titulo1 = '¡Advertencia!';
    var toast_titulo2 = '¡Muy bien!';
    var toast_titulo3 = '¡Error!';
    var toast_titulo4 = '¡Información!';
    var toast_content1 = 'El servicio fue creado exitosamente.';
    var toast_content2 = 'El servicio fue editado exitosamente.';
    var toast_content3 = 'El servicio fue eliminado exitosamente.';
    var toast_content4 = 'Error al asignar/programar sensor al contenedor, las posibles razones del error son: Número de serie mal digitado, no existe conexión con los servidores de Emerson, el sensor posee un viaje activo creado desde otra aplicación, o error no identificado.';
    var toast_content5 = 'El servicio no pudo ser creado.';
    var toast_content6 = 'El contenedor se encuentra en un servicio activo. Acá podrá ver la información del viaje y actualizarla si es necesario.';

    if (lang === 'en') {
        toast_titulo1 = 'Warnings!';
        toast_titulo2 = 'Well done!';
        toast_titulo3 = 'Error!';
        toast_titulo4 = 'Information';
        toast_content1 = 'The service was created successfully.';
        toast_content2 = 'The service was edited successfully.';
        toast_content3 = 'The service was deleted successfully.';
        toast_content4 = 'Error assigning / programming sensor to the container, the possible reasons for the error are: Serial number wrongly typed, there is no connection to Emerson servers, the sensor has an active trip created from another application, or an unidentified error.';
        toast_content5 = 'The service could not be created.';
        toast_content6 = 'The container is in an active service. Here you can see the trip information and update it if necessary.';
    }

    // TOAS FUNCTIONS
    var toasts = [
            { title: toast_titulo1, content: 'Advertencia.', cssClass: 'e-toast-warning', icon: 'e-warning toast-icons' },
            { title: toast_titulo2, content: toast_content1, cssClass: 'e-toast-success', icon: 'e-success toast-icons' },
            { title: toast_titulo2, content: toast_content2, cssClass: 'e-toast-success', icon: 'e-success toast-icons' },
            { title: toast_titulo2, content: toast_content3, cssClass: 'e-toast-success', icon: 'e-success toast-icons' },
            { title: toast_titulo3, content: toast_content4, cssClass: 'e-toast-danger', icon: 'e-error toast-icons' },
            { title: toast_titulo3, content: toast_content5, cssClass: 'e-toast-danger', icon: 'e-error toast-icons' },
            { title: toast_titulo4, content: 'Información.', cssClass: 'e-toast-info', icon: 'e-error toast-icons' },
            { title: toast_titulo4, content: toast_content6, cssClass: 'e-toast-info', icon: 'e-error toast-icons' }];

    var btnEleHide = document.getElementById('hideToast');
    var toastObj;
    var infoBtn = document.getElementById('info_Toast');
    var warnBtn = document.getElementById('warning_Toast');
    var successBtn = document.getElementById('success_Toast');
    var errorBtn = document.getElementById('error_Toast');
    document.onclick = function (e) {
        var toastObj = document.getElementById('toast_type').ej2_instances[0];
        if (e.target !== infoBtn && e.target !== warnBtn && e.target !== successBtn && e.target !== errorBtn) {
            toastObj.hide('All');
        }
    };

    document.getElementById('hideToast').onclick = function () {
        toastObj.hide('All');
    };
    infoBtn.onclick = function () {
        toastObj.show(toasts[1]);
        toastObj.show(toasts[2]);
        toastObj.show(toasts[3]);
        toastObj.show(toasts[4]);
        toastObj.show(toasts[5]);
    };
    warnBtn.onclick = function () {
        toastObj.show(toasts[0]);
    };
    successBtn.onclick = function () {
        toastObj.show(toasts[1]);
    };
    errorBtn.onclick = function () {
        toastObj.show(toasts[2]);
    };

    var toastObj;
    function created() {
        toastObj = this;
    }
    function onclose(e) {
        if (e.toastContainer.childElementCount === 0) {
            btnEleHide.style.display = 'none';
        }
    }
    function onBeforeOpen() {
        btnEleHide.style.display = 'inline-block';
    }

    function getParameterByName(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
            results = regex.exec(location.search);
        return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    }

    $(document).ready(function () {

        var destinatario = '';
        destinatario = getParameterByName('destinatario');

        var listaDestinatarios = @Html.Raw(
            Json.Encode(
                (ViewBag.listaDestinatarios)
            )
        );

        var dropdown_dest = new ej.dropdowns.DropDownList({
            dataSource: listaDestinatarios,
            query: new ej.data.Query(),
            fields: { text: 'Name', value: 'Code' },
            sortOrder: 'Ascending',
            placeholder: 'Destinatario',
            popupHeight: '300px',
        });
        dropdown_dest.appendTo('#destinatario');
        dropdown_dest.text = destinatario;


        @*$.ajax({
            type: "POST",
            url: '@Url.Action("SetTrazabilidadVista", "Trazabilidad")',
            dataType: 'json',
            dataSrc: '',
            data: {
                TipoVista: 6,
                NombreVista: 'AgregarContenedorView'
            }

        });*@

        var urlString = window.location.href;
        let url = new URL(urlString);
        let searchString = url.search.slice(1);
        let searchParams = new URLSearchParams(searchString);
        let inputParam = 'desplegarMensaje';

        if (searchParams.has(inputParam)) {
            if (searchParams.get(inputParam) == 1) {
                desplegarMensaje();
            }
            else if (searchParams.get(inputParam) == 2) {
                desplegarMensajeEditar();
            }
            else if (searchParams.get(inputParam) == 3) {
                desplegarMensajeEliminar();
            } else if (searchParams.get(inputParam) == 4) {
                desplegarMensajeError();
            }
        }

        $("#sensores_agregar").blur( function () {

            var tipo_sensor_seleccionado = document.getElementById("sensores_agregar").ej2_instances[0];

            if (tipo_sensor_seleccionado.value == 5) {

                $.ajax({
                    type: "POST",
                    url: '@Url.Action("ValidarModem", "Servicio")',
                    data: { numSerie: $("#numero_serie_agregar").val() },
                    success: function (response) {

                        if (response != "True") { // no es modem

                            var numero_sensor = document.getElementById("numero_serie_agregar").ej2_instances[0];
                            numero_sensor.value = "";

                            tipo_sensor_seleccionado.value = "";
                            tipo_sensor_seleccionado.enabled = true;

                            var texto = '¡El número de serie no coincide con un Sensor CO2 Genérico!';
                            if (lang === 'en') {
                                texto = '¡Serial number does not match a Generic CO2 Sensor!';
                            }

                            Swal.fire({
                                icon: 'error',
                                title: 'Oops...',
                                text: texto,
                            });
                        }
                    }
                });
            }

        });

        $("#sensores_agregar2").blur(function () {

            var tipo_sensor_seleccionado = document.getElementById("sensores_agregar2").ej2_instances[0];

            if (tipo_sensor_seleccionado.value == 5) {

                $.ajax({
                    type: "POST",
                    url: '@Url.Action("ValidarModem", "Servicio")',
                    data: { numSerie: $("#numero_serie_agregar2").val() },
                    success: function (response) {

                        if (response != "True") { // no es modem

                            var numero_sensor = document.getElementById("numero_serie_agregar2").ej2_instances[0];
                            numero_sensor.value = "";

                            tipo_sensor_seleccionado.value = "";
                            tipo_sensor_seleccionado.enabled = true;

                            var texto = '¡El número de serie no coincide con un Sensor CO2 Genérico!';
                            if (lang === 'en') {
                                texto = '¡Serial number does not match a Generic CO2 Sensor!';
                            }

                            Swal.fire({
                                icon: 'error',
                                title: 'Oops...',
                                text: texto,
                            });
                        }
                    }
                });
            }

        });

        $("#sensores_agregar3").blur(function () {

            var tipo_sensor_seleccionado = document.getElementById("sensores_agregar3").ej2_instances[0];

            if (tipo_sensor_seleccionado.value == 5) {

                $.ajax({
                    type: "POST",
                    url: '@Url.Action("ValidarModem", "Servicio")',
                    data: { numSerie: $("#numero_serie_agregar3").val() },
                    success: function (response) {

                        if (response != "True") { // no es modem

                            var numero_sensor = document.getElementById("numero_serie_agregar3").ej2_instances[0];
                            numero_sensor.value = "";

                            tipo_sensor_seleccionado.value = "";
                            tipo_sensor_seleccionado.enabled = true;

                            var texto = '¡El número de serie no coincide con un Sensor CO2 Genérico!';
                            if (lang === 'en') {
                                texto = '¡Serial number does not match a Generic CO2 Sensor!';
                            }

                            Swal.fire({
                                icon: 'error',
                                title: 'Oops...',
                                text: texto,
                            });
                        }
                    }
                });
            }

        });

        $("#sensores_agregar4").blur(function () {

            var tipo_sensor_seleccionado = document.getElementById("sensores_agregar4").ej2_instances[0];

            if (tipo_sensor_seleccionado.value == 5) {

                $.ajax({
                    type: "POST",
                    url: '@Url.Action("ValidarModem", "Servicio")',
                    data: { numSerie: $("#numero_serie_agregar4").val() },
                    success: function (response) {

                        if (response != "True") { // no es modem

                            var numero_sensor = document.getElementById("numero_serie_agregar4").ej2_instances[0];
                            numero_sensor.value = "";

                            tipo_sensor_seleccionado.value = "";
                            tipo_sensor_seleccionado.enabled = true;

                            var texto = '¡El número de serie no coincide con un Sensor CO2 Genérico!';
                            if (lang === 'en') {
                                texto = '¡Serial number does not match a Generic CO2 Sensor!';
                            }

                            Swal.fire({
                                icon: 'error',
                                title: 'Oops...',
                                text: texto,
                            });
                        }
                    }
                });
            }

        });

        $("#sensores_agregar5").blur(function () {

            var tipo_sensor_seleccionado = document.getElementById("sensores_agregar5").ej2_instances[0];

            if (tipo_sensor_seleccionado.value == 5) {

                $.ajax({
                    type: "POST",
                    url: '@Url.Action("ValidarModem", "Servicio")',
                    data: { numSerie: $("#numero_serie_agregar5").val() },
                    success: function (response) {

                        if (response != "True") { // no es modem

                            var numero_sensor = document.getElementById("numero_serie_agregar5").ej2_instances[0];
                            numero_sensor.value = "";

                            tipo_sensor_seleccionado.value = "";
                            tipo_sensor_seleccionado.enabled = true;

                            var texto = '¡El número de serie no coincide con un Sensor CO2 Genérico!';
                            if (lang === 'en') {
                                texto = '¡Serial number does not match a Generic CO2 Sensor!';
                            }

                            Swal.fire({
                                icon: 'error',
                                title: 'Oops...',
                                text: texto,
                            });
                        }
                    }
                });
            }

        });
    });


    function desplegarMensaje() {
        var toastObj = document.getElementById('toast_type').ej2_instances[0];
        setTimeout(function () {
            toastObj.target = document.body;
            toastObj.show(toasts[1]);
        }, 500);
    }
    function desplegarMensajeEditar() {
        var toastObj = document.getElementById('toast_type').ej2_instances[0];
        setTimeout(function () {
            toastObj.target = document.body;
            toastObj.show(toasts[2]);
        }, 500);
    }
    function desplegarMensajeEliminar() {
        var toastObj = document.getElementById('toast_type').ej2_instances[0];
        setTimeout(function () {
            toastObj.target = document.body;
            toastObj.show(toasts[3]);
        }, 500);
    }
    function desplegarMensajeError() {
        var toastObj = document.getElementById('toast_type').ej2_instances[0];
        setTimeout(function () {
            toastObj.target = document.body;
            toastObj.show(toasts[4]);
        }, 500);
    }



    function FormatDate(data) {
        var dateString = data.substr(6);
        var currentTime = new Date(parseInt(dateString));
        var month = currentTime.getMonth() + 1;
        var day = currentTime.getDate();
        var year = currentTime.getFullYear();

        if (month < 10) {
            month = "0" + month;
        } else {
            month;
        }

        if (day < 10) {
            day = "0" + day;
        } else {
            day;
        }

        var date = day + "-" + month + "-" + year;
        return date;
    }



    var boton_agregar_sensor = document.getElementById('btn-agregar-sensor');
    boton_agregar_sensor.addEventListener("click", function () {
        var sensor1_oculto = $("#div_sensores1").is(":hidden");
        if (sensor1_oculto == true) {
            document.getElementById("div_sensores1").style.display = 'block';
        }
        else {
            var sensor2_oculto = $("#div_sensores2").is(":hidden");
            if (sensor2_oculto == true) {
                document.getElementById("div_sensores2").style.display = 'block';
            }
            else {
                var sensor3_oculto = $("#div_sensores3").is(":hidden");
                if (sensor3_oculto == true) {
                    document.getElementById("div_sensores3").style.display = 'block';
                }
                else {
                    var sensor4_oculto = $("#div_sensores4").is(":hidden");
                    if (sensor4_oculto == true) {
                        document.getElementById("div_sensores4").style.display = 'block';
                    }
                    else {
                        var sensor5_oculto = $("#div_sensores5").is(":hidden");
                        if (sensor5_oculto == true) {
                            document.getElementById("div_sensores5").style.display = 'block';
                        }
                    }
                }
            }
        }
    });

    var boton_eliminar_sensor = document.getElementById('btn-eliminar-sensor');
    boton_eliminar_sensor.addEventListener("click", function () {
        var sensor5_oculto = $("#div_sensores5").is(":hidden");
        if (sensor5_oculto == false) {
            document.getElementById("div_sensores5").style.display = 'none';
        }
        else {
            var sensor4_oculto = $("#div_sensores4").is(":hidden");
            if (sensor4_oculto == false) {
                document.getElementById("div_sensores4").style.display = 'none';
            }
            else {
                var sensor3_oculto = $("#div_sensores3").is(":hidden");
                if (sensor3_oculto == false) {
                    document.getElementById("div_sensores3").style.display = 'none';
                }
                else {
                    var sensor2_oculto = $("#div_sensores2").is(":hidden");
                    if (sensor2_oculto == false) {
                        document.getElementById("div_sensores2").style.display = 'none';
                    }
                    else {
                        var sensor1_oculto = $("#div_sensores1").is(":hidden");
                        if (sensor1_oculto == false) {
                            document.getElementById("div_sensores1").style.display = 'none';
                        }
                    }
                }
            }
        }
    });


    var boton_validar_contenedor = document.getElementById('btn-validar_contenedor');
    boton_validar_contenedor.addEventListener("click", function () {
        if ($("#contenedor_agregar").val() != "") {
            $.ajax({
                type: "POST",
                url: '@Url.Action("ValidarNumeroContenedor", "Servicio")',
                data: { containerNumberToCheck: $("#contenedor_agregar").val() },
                success: function (response) {
                    if (response == "False") {

                        var titulo = '¡Número de contenedor inválido!';
                        var texto = 'Vuelva a escribir el número del contenedor.';
                        if (lang === 'en') {
                            titulo = 'Invalid container number!';
                            texto = 'Retype the container number.';
                        }

                        Swal.fire({
                            icon: 'error',
                            title: titulo,
                            text: texto,
                        });
                        $("#contenedor_agregar").val("");
                        return false;

                    } else {

                        $.ajax({
                            type: "POST",
                            url: '@Url.Action("ObtenerDatosServicioPorContenedor", "Servicio")',
                            dataType: 'json',
                            data: { contenedor: $("#contenedor_agregar").val() },
                            async: false,
                            success: function (response) {

                                HabilitarOtrosCampos_agregar();

                                if (response != null && response.id > 0) {

                                    var origen_agregar = document.getElementById("lugar_origen_agregar").ej2_instances[0];
                                    var destino_agregar = document.getElementById("lugar_destino_agregar").ej2_instances[0];
                                    var eta_agregar = document.getElementById("eta_agregar").ej2_instances[0];
                                    var etd_agregar = document.getElementById("etd_agregar").ej2_instances[0];
                                    var booking_agregar = document.getElementById("booking_agregar").ej2_instances[0];
                                    var nave_agregar = document.getElementById("nave_agregar").ej2_instances[0];
                                    var commodity_agregar = document.getElementById("commodity_agregar").ej2_instances[0];
                                    var naviera_agregar = document.getElementById("naviera_agregar").ej2_instances[0];
                                    var setpoint_co2_agregar = document.getElementById("setpoint_co2_agregar").ej2_instances[0];
                                    var setpoint_temp_agregar = document.getElementById("setpoint_temp_agregar").ej2_instances[0];
                                    var descripcion_agregar = document.getElementById("descripcion_agregar").ej2_instances[0];
                                    origen_agregar.value = response.lugar_origen;
                                    destino_agregar.value = response.lugar_destino;
                                    eta_agregar.value = response.eta_string;
                                    etd_agregar.value = response.etd_string;
                                    booking_agregar.value = response.booking;
                                    nave_agregar.value = response.nave;
                                    commodity_agregar.value = response.commodity;
                                    naviera_agregar.value = response.naviera;
                                    setpoint_co2_agregar.value = response.setpoint_co2; //.substring(0, (response.setpoint_co2).search(",") + 2);

                                    setpoint_temp_agregar.value = response.setpoint_temp; //.substring(0, (response.setpoint_temp).search(",") +2);
                                    descripcion_agregar.value = response.descripcion;

                                    document.getElementById("btn-editar_agregar").style.display = 'inline-block';
                                    document.getElementById("btn-guardar_agregar").style.display = 'none';

                                    LlenarCamposSensores();

                                    //validado OK
                                    document.getElementById("btn-validar_contenedor").style.display = 'none';
                                    var contenedor_bloqueado = document.getElementById("contenedor_agregar").ej2_instances[0];
                                    contenedor_bloqueado.enabled = false;

                                }

                            }
                        });
                    }
                }
            });
        }
    });







    //$("#rb_si").click(function () {
    //    var seleccionado = findSelection("Seleccion");

    //    if (seleccionado=="SI")
    //    {
    //        $("#div_sensores1").show();
    //        $("#div-tipo-sensor_agregar1").hide();
    //        $("#div-numero-serie_agregar1").hide();
    //        $("#div-btn_agregar_sensor").show();
    //        $("#div-eliminar_sensor1").hide();

    //        $("#div_seccion_sensores").show();
    //    }
    //});

    //$("#rb_no").click(function () {
    //    var seleccionado = findSelection("Seleccion");

    //    if (seleccionado == "NO") {

    //        limpiarTodosLosCampos();

    //        $("#div-tipo-sensor_agregar1").hide();
    //        $("#div-numero-serie_agregar1").hide();
    //        $("#div-btn_agregar_sensor").show();
    //        $("#div-eliminar_sensor1").hide();
    //        $("#div_sensores2").hide();

    //        $("#div-tipo-sensor_agregar2").hide();
    //        $("#div-numero-serie_agregar2").hide();
    //        $("#div-btn_agregar_sensor2").hide();
    //        $("#div-eliminar_sensor2").hide();
    //        $("#div_sensores3").hide();

    //        $("#div-tipo-sensor_agregar3").hide();
    //        $("#div-numero-serie_agregar3").hide();
    //        $("#div-btn_agregar_sensor3").hide();
    //        $("#div-eliminar_sensor3").hide();
    //        $("#div_sensores4").hide();

    //        $("#div-tipo-sensor_agregar4").hide();
    //        $("#div-numero-serie_agregar4").hide();
    //        $("#div-btn_agregar_sensor4").hide();
    //        $("#div-eliminar_sensor4").hide();
    //        $("#div_sensores5").hide();

    //        $("#div-tipo-sensor_agregar5").hide();
    //        $("#div-numero-serie_agregar5").hide();
    //        $("#div-btn_agregar_sensor5").hide();
    //        $("#div-eliminar_sensor5").hide();

    //        $("#div_seccion_sensores").hide();
    //    }
    //});


    function findSelection(field) {
        var test = document.getElementsByName(field);
        var sizes = test.length;
        for (i = 0; i < sizes; i++) {
            if (test[i].checked == true) {
                return test[i].value;
            }
        }
    }

    var boton_limpiar = document.getElementById('btn-limpiar_agregar');
    boton_limpiar.addEventListener("click", function () {
        var contenedor_agregar = document.getElementById("contenedor_agregar").ej2_instances[0];
        var eta_agregar = document.getElementById("eta_agregar").ej2_instances[0];
        var etd_agregar = document.getElementById("etd_agregar").ej2_instances[0];
        var booking_agregar = document.getElementById("booking_agregar").ej2_instances[0];
        var origen_agregar = document.getElementById("lugar_origen_agregar").ej2_instances[0];
        var destino_agregar = document.getElementById("lugar_destino_agregar").ej2_instances[0];
        var descripcion_agregar = document.getElementById("descripcion_agregar").ej2_instances[0];

        var nave_agregar = document.getElementById("nave_agregar").ej2_instances[0];
        var commodity_agregar = document.getElementById("commodity_agregar").ej2_instances[0];
        var naviera_agregar = document.getElementById("naviera_agregar").ej2_instances[0];
        var setpoint_co2_agregar = document.getElementById("setpoint_co2_agregar").ej2_instances[0];
        var setpoint_temp_agregar = document.getElementById("setpoint_temp_agregar").ej2_instances[0];
        var sensores_agregar = document.getElementById("sensores_agregar").ej2_instances[0];
        var numero_serie_agregar = document.getElementById("numero_serie_agregar").ej2_instances[0];
        var sensores_agregar2 = document.getElementById("sensores_agregar2").ej2_instances[0];
        var numero_serie_agregar2 = document.getElementById("numero_serie_agregar2").ej2_instances[0];
        var sensores_agregar3 = document.getElementById("sensores_agregar3").ej2_instances[0];
        var numero_serie_agregar3 = document.getElementById("numero_serie_agregar3").ej2_instances[0];
        var sensores_agregar4 = document.getElementById("sensores_agregar4").ej2_instances[0];
        var numero_serie_agregar4 = document.getElementById("numero_serie_agregar4").ej2_instances[0];
        var sensores_agregar5 = document.getElementById("sensores_agregar5").ej2_instances[0];
        var numero_serie_agregar5 = document.getElementById("numero_serie_agregar5").ej2_instances[0];
        //var rb_no = document.getElementById("rb_no").ej2_instances[0];

        //rb_no.checked = true;
        contenedor_agregar.value = "";
        eta_agregar.value = "";
        etd_agregar.value = "";
        booking_agregar.value = "";
        origen_agregar.value = "";
        destino_agregar.value = "";
        descripcion_agregar.value = "";
        nave_agregar.value = "";
        commodity_agregar.value = "";
        naviera_agregar.value = "";
        setpoint_co2_agregar.value = "";
        setpoint_temp_agregar.value = "";
        sensores_agregar.value = "";
        numero_serie_agregar.value = "";
        sensores_agregar2.value = "";
        numero_serie_agregar2.value = "";
        sensores_agregar3.text = "";
        numero_serie_agregar3.value = "";
        sensores_agregar4.text = "";
        numero_serie_agregar4.value = "";
        sensores_agregar5.text = "";
        numero_serie_agregar5.value = "";

        document.getElementById("btn-editar_agregar").style.display = 'none';
        document.getElementById("btn-guardar_agregar").style.display = 'inline-block';
        document.getElementById("btn-validar_contenedor").style.display = 'inline-block';
        var contenedor_bloqueado = document.getElementById("contenedor_agregar").ej2_instances[0];
        contenedor_bloqueado.enabled = true;

    });



    $("#numero_serie_agregar").blur(function () {

        $.ajax({
            type: "POST",
            url: '@Url.Action("ValidarModem", "Servicio")',
                  data: { numSerie: $("#numero_serie_agregar").val() },
                success: function (response) {
                    var sensores_agregar = document.getElementById("sensores_agregar").ej2_instances[0];

                    if (response != "False") { // es modem

                        sensores_agregar.value = "CO2 Generico";
                        sensores_agregar.enabled = false;

                    } else {

                        sensores_agregar.value = "";
                        sensores_agregar.enabled = true;

                        if ($("#numero_serie_agregar").val() != "") {

                             $.ajax({
                                type: "POST",
                                url: '@Url.Action("ValidarSensorEnServicio", "Servicio")',
                                data: { num_sensor: $("#numero_serie_agregar").val() },
                                success: function (response) {
                                    if (response != "0") {
                                        var titulo = '¡Sensor asociado a otro viaje!';
                                        var texto = 'El sensor está asociado al contenedor ' + response;
                                        if (lang === 'en') {
                                            titulo = 'Sensor associated with another trip!';
                                            texto = 'The sensor is associated with the container ' + response;
                                        }

                                        Swal.fire({
                                            icon: 'error',
                                            title: titulo,
                                            text: texto,
                                        });
                                        $("#numero_serie_agregar").value("");
                                        return false;
                                    }
                                    else {
                                        return false;
                                    }
                                }
                            });
                        }

                    }
                }
        });

    });

    $("#numero_serie_agregar2").blur(function () {

            $.ajax({
                type: "POST",
                url: '@Url.Action("ValidarModem", "Servicio")',
                data: { numSerie: $("#numero_serie_agregar2").val() },
                success: function (response) {
                    var sensores_agregar = document.getElementById("sensores_agregar2").ej2_instances[0];

                    if (response != "False") { // es modem

                        sensores_agregar.value = "CO2 Generico";
                        sensores_agregar.enabled = false;

                    } else {

                        sensores_agregar.value = "";
                        sensores_agregar.enabled = true;

                        if ($("#numero_serie_agregar2").val() != "") {
                        $.ajax({
                            type: "POST",
                            url: '@Url.Action("ValidarSensorEnServicio", "Servicio")',
                                data: { num_sensor: $("#numero_serie_agregar2").val() },
                                success: function (response) {
                                    if (response == "False") {
                                        var titulo = '¡Sensor asociado a otro viaje!';
                                        var texto = 'El sensor está asociado al contenedor ' + response;
                                        if (lang === 'en') {
                                            titulo = 'Sensor associated with another trip!';
                                            texto = 'The sensor is associated with the container ' + response;
                                        }

                                        Swal.fire({
                                            icon: 'error',
                                            title: titulo,
                                            text: texto,
                                        });
                                        $("#numero_serie_agregar2").val("");
                                        return false;
                                    }
                                    else {
                                        return false;
                                    }
                                }
                            });
                        }

                    }
                }
            });

    });

    $("#numero_serie_agregar3").blur(function () {

        $.ajax({
            type: "POST",
            url: '@Url.Action("ValidarModem", "Servicio")',
            data: { numSerie: $("#numero_serie_agregar3").val() },
            success: function (response) {
                var sensores_agregar = document.getElementById("sensores_agregar3").ej2_instances[0];

                if (response != "False") { // es modem

                    sensores_agregar.value = "CO2 Generico";
                    sensores_agregar.enabled = false;

                } else {

                    sensores_agregar.value = "";
                    sensores_agregar.enabled = true;

                    if ($("#numero_serie_agregar3").val() != "") {

                        $.ajax({
                            type: "POST",
                            url: '@Url.Action("ValidarSensorEnServicio", "Servicio")',
                            data: { num_sensor: $("#numero_serie_agregar3").val() },
                            success: function (response) {
                                if (response == "False") {
                                    var titulo = '¡Sensor asociado a otro viaje!';
                                    var texto = 'El sensor está asociado al contenedor ' + response;
                                    if (lang === 'en') {
                                        titulo = 'Sensor associated with another trip!';
                                        texto = 'The sensor is associated with the container ' + response;
                                    }

                                    Swal.fire({
                                        icon: 'error',
                                        title: titulo,
                                        text: texto,
                                    });
                                    $("#numero_serie_agregar3").val("");
                                    return false;
                                }
                                else {
                                    return false;
                                }
                            }
                        });
                    }

                }
            }
        });

    });


    $("#numero_serie_agregar4").blur(function () {

        $.ajax({
            type: "POST",
            url: '@Url.Action("ValidarModem", "Servicio")',
            data: { numSerie: $("#numero_serie_agregar4").val() },
            success: function (response) {
                var sensores_agregar = document.getElementById("sensores_agregar4").ej2_instances[0];

                if (response != "False") { // es modem

                    sensores_agregar.value = "CO2 Generico";
                    sensores_agregar.enabled = false;

                } else {

                    sensores_agregar.value = "";
                    sensores_agregar.enabled = true;

                    if ($("#numero_serie_agregar4").val() != "") {
                        $.ajax({
                            type: "POST",
                            url: '@Url.Action("ValidarSensorEnServicio", "Servicio")',
                            data: { num_sensor: $("#numero_serie_agregar4").val() },
                            success: function (response) {
                                if (response == "False") {
                                    var titulo = '¡Sensor asociado a otro viaje!';
                                    var texto = 'El sensor está asociado al contenedor ' + response;
                                    if (lang === 'en') {
                                        titulo = 'Sensor associated with another trip!';
                                        texto = 'The sensor is associated with the container ' + response;
                                    }

                                    Swal.fire({
                                        icon: 'error',
                                        title: titulo,
                                        text: texto,
                                    });
                                    $("#numero_serie_agregar4").val("");
                                    return false;
                                }
                                else {
                                    return false;
                                }
                            }
                        });
                    }

                }
            }
        });

    });

    $("#numero_serie_agregar5").blur(function () {

        $.ajax({
            type: "POST",
            url: '@Url.Action("ValidarModem", "Servicio")',
            data: { numSerie: $("#numero_serie_agregar4").val() },
            success: function (response) {
                var sensores_agregar = document.getElementById("sensores_agregar5").ej2_instances[0];

                if (response != "False") { // es modem

                    sensores_agregar.value = "CO2 Generico";
                    sensores_agregar.enabled = false;

                } else {

                    sensores_agregar.value = "";
                    sensores_agregar.enabled = true;

                    if ($("#numero_serie_agregar5").val() != "") {
                        $.ajax({
                            type: "POST",
                            url: '@Url.Action("ValidarSensorEnServicio", "Servicio")',
                            data: { num_sensor: $("#numero_serie_agregar5").val() },
                            success: function (response) {
                                if (response == "False") {
                                    var titulo = '¡Sensor asociado a otro viaje!';
                                    var texto = 'El sensor está asociado al contenedor ' + response;
                                    if (lang === 'en') {
                                        titulo = 'Sensor associated with another trip!';
                                        texto = 'The sensor is associated with the container ' + response;
                                    }

                                    Swal.fire({
                                        icon: 'error',
                                        title: titulo,
                                        text: texto,
                                    });
                                    $("#numero_serie_agregar5").val("");
                                    return false;
                                }
                                else {
                                    return false;
                                }
                            }
                        });
                    }

                }
            }
        });

    });

    function limpiarTodosLosCampos()
    {
        var sensores_agregar = document.getElementById("sensores_agregar").ej2_instances[0];
        var numero_serie_agregar = document.getElementById("numero_serie_agregar").ej2_instances[0];
        var sensores_agregar2 = document.getElementById("sensores_agregar2").ej2_instances[0];
        var numero_serie_agregar2 = document.getElementById("numero_serie_agregar2").ej2_instances[0];
        var sensores_agregar3 = document.getElementById("sensores_agregar3").ej2_instances[0];
        var numero_serie_agregar3 = document.getElementById("numero_serie_agregar3").ej2_instances[0];
        var sensores_agregar4 = document.getElementById("sensores_agregar4").ej2_instances[0];
        var numero_serie_agregar4 = document.getElementById("numero_serie_agregar4").ej2_instances[0];
        var sensores_agregar5 = document.getElementById("sensores_agregar5").ej2_instances[0];
        var numero_serie_agregar5 = document.getElementById("numero_serie_agregar5").ej2_instances[0];
        //var rb_no = document.getElementById("rb_no").ej2_instances[0];

        //rb_no.checked = true;

        sensores_agregar.value = "";
        numero_serie_agregar.value = "";
        sensores_agregar2.value = "";
        numero_serie_agregar2.value = "";
        sensores_agregar3.text = "";
        numero_serie_agregar3.value = "";
        sensores_agregar4.text = "";
        numero_serie_agregar4.value = "";
        sensores_agregar5.text = "";
        numero_serie_agregar5.value = "";
    }


    function contenedorChange_agregar() {

        var div_contenedor_agregar = document.getElementById("div-contenedor_agregar").childNodes;
        div_contenedor_agregar[1].style.borderColor = "#ced4da";

        /*var contenedor = document.getElementById('contenedor').ej2_instances[0];
        habilitar_campos = false;
        contenedor.dataSource.forEach(validarContenedor);
        if (habilitar_campos) {
            var div_lugar_origen = document.getElementById("div-lugar-origen").childNodes;
            div_lugar_origen[1].style.borderColor = "#ced4da";
            var div_lugar_destino = document.getElementById("div-lugar-destino").childNodes;
            div_lugar_destino[1].style.borderColor = "#ced4da";

            HabilitarOtrosCampos();
            LlenarOtrosCampos();
        }
        else {
            DeshabilitarOtrosCampos();
        }*/
    }



    var habilitar_campos_agregar = false;

    function onfilteringContenedor_agregar(e) {
        document.getElementById('contenedor_agregar').value = document.getElementById('contenedor_agregar').value.toUpperCase();
        var contenedor_agregar = document.getElementById('contenedor_agregar').ej2_instances[0];
        var query = new ej.data.Query();
        query = (e.text !== '') ? query.where('Name', 'startswith', e.text, true) : query;
        e.updateData(contenedor_agregar.dataSource, query);

        if (document.getElementById('nodata-contenedor_agregar')) {
            document.getElementById('btn-contenedor_agregar').onclick = function () {


                $.ajax({
                    type: "POST",
                    url: '@Url.Action("ValidarNumeroContenedor", "Servicio")',
                    data: { containerNumberToCheck: $("#contenedor_agregar").val() },
                    success: function (response) {
                        if (response == "False") {
                            var texto = '¡Número contenedor inválido!';
                            if (lang === 'en') {
                                texto = 'Invalid container number!';
                            }

                            Swal.fire({
                                icon: 'error',
                                title: 'Oops...',
                                text: texto,
                            });
                            $("#contenedor_agregar").val("");
                            return false;
                        }
                        else {
                            var customValue = (document.getElementById('contenedor_agregar')).value;
                            var newItem = { 'Name': customValue, 'Code': customValue };
                            (contenedor_agregar.dataSource).push(newItem);
                            contenedor_agregar.hidePopup();
                            contenedor_agregar.addItem(newItem);
                            contenedor_agregar.value = customValue;
                            HabilitarOtrosCampos_agregar();
                            return false;
                        }
                    }
                });

            };
        }
    }

    function contenedorChange_agregar() {

        var div_contenedor_agregar = document.getElementById("div-contenedor_agregar").childNodes;
        div_contenedor_agregar[1].style.borderColor = "#ced4da";

        var contenedor_agregar = document.getElementById('contenedor_agregar').ej2_instances[0];
        habilitar_campos_agregar = false;
        contenedor_agregar.dataSource.forEach(validarContenedor_agregar);
        if (habilitar_campos_agregar) {
            var div_lugar_origen_agregar = document.getElementById("div-lugar-origen_agregar").childNodes;
            div_lugar_origen_agregar[1].style.borderColor = "#ced4da";
            var div_lugar_destino_agregar = document.getElementById("div-lugar-destino_agregar").childNodes;
            div_lugar_destino_agregar[1].style.borderColor = "#ced4da";

            HabilitarOtrosCampos_agregar();
            LlenarOtrosCampos_agregar();
        }
        else {
            DeshabilitarOtrosCampos_agregar();
        }
    }

    function validarContenedor_agregar(item, index) {
        if (document.getElementById('contenedor_agregar').value == item.Name) {
            habilitar_campos_agregar = true;
        }
    }

    function sensoresChange_agregar() {
        var div_tipo_sensor_agregar = document.getElementById("div-tipo-sensor_agregar1").childNodes;
        div_tipo_sensor_agregar[1].style.borderColor = "#ced4da";
    }

    function sensoresChange_agregar2() {
        var div_tipo_sensor_agregar = document.getElementById("div-tipo-sensor_agregar2").childNodes;
        div_tipo_sensor_agregar[1].style.borderColor = "#ced4da";
    }
    function sensoresChange_agregar3() {
        var div_tipo_sensor_agregar = document.getElementById("div-tipo-sensor_agregar3").childNodes;
        div_tipo_sensor_agregar[1].style.borderColor = "#ced4da";
    }
    function sensoresChange_agregar4() {
        var div_tipo_sensor_agregar = document.getElementById("div-tipo-sensor_agregar4").childNodes;
        div_tipo_sensor_agregar[1].style.borderColor = "#ced4da";
    }
    function sensoresChange_agregar5() {
        var div_tipo_sensor_agregar = document.getElementById("div-tipo-sensor_agregar5").childNodes;
        div_tipo_sensor_agregar[1].style.borderColor = "#ced4da";
    }
    function numeroSerieChange_agregar() {
        var div_numero_serie_agregar = document.getElementById("div-numero-serie_agregar1").childNodes;
        div_numero_serie_agregar[1].style.borderColor = "#ced4da";
    }
    function numeroSerieChange_agregar2() {
        var div_numero_serie_agregar = document.getElementById("div-numero-serie_agregar2").childNodes;
        div_numero_serie_agregar[1].style.borderColor = "#ced4da";
    }
    function numeroSerieChange_agregar3() {
        var div_numero_serie_agregar = document.getElementById("div-numero-serie_agregar3").childNodes;
        div_numero_serie_agregar[1].style.borderColor = "#ced4da";
    }
    function numeroSerieChange_agregar4() {
        var div_numero_serie_agregar = document.getElementById("div-numero-serie_agregar4").childNodes;
        div_numero_serie_agregar[1].style.borderColor = "#ced4da";
    }
    function numeroSerieChange_agregar5() {
        var div_numero_serie_agregar = document.getElementById("div-numero-serie_agregar5").childNodes;
        div_numero_serie_agregar[1].style.borderColor = "#ced4da";
    }
    function origenChange_agregar() {
        //var div_lugar_origen_agregar = document.getElementById("div-lugar-origen_agregar").childNodes;
        //div_lugar_origen_agregar[1].style.borderColor = "#ced4da";
    }
    function destinoChange_agregar() {
        //var div_lugar_destino_agregar = document.getElementById("div-lugar-destino_agregar").childNodes;
        //div_lugar_destino_agregar[1].style.borderColor = "#ced4da";
    }


    function changeSP_CO2(args) {
        var valor = args.value.replace('.', ',');
        document.getElementById("setpoint_co2_agregar").ej2_instances[0].value = valor;
    }
    function changeSP_Temp(args) {
        var valor = args.value.replace('.', ',');
        document.getElementById("setpoint_temp_agregar").ej2_instances[0].value = valor;
    }




    function HabilitarOtrosCampos_agregar() {
        var campo1_agregar = document.getElementById("lugar_origen_agregar").ej2_instances[0];
        var campo2_agregar = document.getElementById("lugar_destino_agregar").ej2_instances[0];
        var campo3_agregar = document.getElementById("eta_agregar").ej2_instances[0];
        var campo4_agregar = document.getElementById("etd_agregar").ej2_instances[0];
        var campo5_agregar = document.getElementById("booking_agregar").ej2_instances[0];
        var campo6_agregar = document.getElementById("nave_agregar").ej2_instances[0];
        var campo7_agregar = document.getElementById("commodity_agregar").ej2_instances[0];
        var campo8_agregar = document.getElementById("naviera_agregar").ej2_instances[0];
        var campo9_agregar = document.getElementById("setpoint_co2_agregar").ej2_instances[0];
        var campo10_agregar = document.getElementById("setpoint_temp_agregar").ej2_instances[0];
        var campo11_agregar = document.getElementById("descripcion_agregar").ej2_instances[0];
        //var campo12_agregar = document.getElementById("rb_si").ej2_instances[0];
        //var campo13_agregar = document.getElementById("rb_no").ej2_instances[0];
        campo1_agregar.enabled = true;
        campo2_agregar.enabled = true;
        campo3_agregar.enabled = true;
        campo4_agregar.enabled = true;
        campo5_agregar.enabled = true;
        campo6_agregar.enabled = true;
        campo7_agregar.enabled = true;
        campo8_agregar.enabled = true;
        campo9_agregar.enabled = true;
        campo10_agregar.enabled = true;
        campo11_agregar.enabled = true;
        //campo12_agregar.enabled = true;
        //campo13_agregar.enabled = true;
        campo1_agregar.dataBind();
        campo2_agregar.dataBind();
        campo3_agregar.dataBind();
        campo4_agregar.dataBind();
        campo5_agregar.dataBind();
        campo6_agregar.dataBind();
        campo7_agregar.dataBind();
        campo8_agregar.dataBind();
        campo9_agregar.dataBind();
        campo10_agregar.dataBind();
        campo11_agregar.dataBind();
        //campo12_agregar.dataBind();
        //campo13_agregar.dataBind();
    }

    function DeshabilitarOtrosCampos_agregar() {
        var campo1_agregar = document.getElementById("lugar_origen_agregar").ej2_instances[0];
        var campo2_agregar = document.getElementById("lugar_destino_agregar").ej2_instances[0];
        var campo3_agregar = document.getElementById("eta_agregar").ej2_instances[0];
        var campo4_agregar = document.getElementById("etd_agregar").ej2_instances[0];
        var campo5_agregar = document.getElementById("booking_agregar").ej2_instances[0];
        var campo6_agregar = document.getElementById("nave_agregar").ej2_instances[0];
        var campo7_agregar = document.getElementById("commodity_agregar").ej2_instances[0];
        var campo8_agregar = document.getElementById("naviera_agregar").ej2_instances[0];
        var campo9_agregar = document.getElementById("setpoint_co2_agregar").ej2_instances[0];
        var campo10_agregar = document.getElementById("setpoint_temp_agregar").ej2_instances[0];
        var campo11_agregar = document.getElementById("nombre_lugar_origen_agregar").ej2_instances[0];
        var campo12_agregar = document.getElementById("nombre_lugar_destino_agregar").ej2_instances[0];
        campo1_agregar.value = "";
        campo2_agregar.value = "";
        campo3_agregar.value = "";
        campo4_agregar.value = "";
        campo5_agregar.value = "";
        campo6_agregar.value = "";
        campo7_agregar.value = "";
        campo8_agregar.value = "";
        campo9_agregar.value = "";
        campo10_agregar.value = "";
        campo11_agregar.value = "";
        campo12_agregar.value = "";
        campo1_agregar.enabled = false;
        campo2_agregar.enabled = false;
        campo3_agregar.enabled = false;
        campo4_agregar.enabled = false;
        campo5_agregar.enabled = false;
        campo6_agregar.enabled = false;
        campo7_agregar.enabled = false;
        campo8_agregar.enabled = false;
        campo9_agregar.enabled = false;
        campo10_agregar.enabled = false;
        campo11_agregar.enabled = false;
        campo12_agregar.enabled = false;
        campo1_agregar.dataBind();
        campo2_agregar.dataBind();
        campo3_agregar.dataBind();
        campo4_agregar.dataBind();
        campo5_agregar.dataBind();
        campo6_agregar.dataBind();
        campo7_agregar.dataBind();
        campo8_agregar.dataBind();
        campo9_agregar.dataBind();
        campo10_agregar.dataBind();
        campo11_agregar.dataBind();
        campo12_agregar.dataBind();
    }

    function LlenarOtrosCampos_agregar() {
        $.ajax({
            type: "POST",
            url: '@Url.Action("ObtenerDatosServicio", "Servicio")',
            dataType: 'json',
            data: { contenedor: $("#contenedor_agregar").val() },
            success: function (response) {
                if (response.id > 0) {
                    var titulo = '¡Contenedor válido!';
                    var texto = 'Se precargó la información del viaje preexistente en Alma, si desea puede editarla.';
                    if (lang === 'en') {
                        titulo = 'Valid container!';
                        texto = 'Pre-existing trip information was preloaded in Alma, if you wish you can edit it.';
                    }

                    Swal.fire({
                        icon: 'success',
                        title: titulo,
                        text: texto,
                        showConfirmButton: false,
                        timer: 4000
                    });

                    document.getElementById('servicio_app_servicios_agregar').value = 1;
                    //DeshabilitarOtrosCampos_agregar();
                    var eta_agregar = document.getElementById("eta_agregar").ej2_instances[0];
                    var etd_agregar = document.getElementById("etd_agregar").ej2_instances[0];
                    var booking_agregar = document.getElementById("booking_agregar").ej2_instances[0];
                    var origen_agregar = document.getElementById("lugar_origen_agregar").ej2_instances[0];
                    var destino_agregar = document.getElementById("lugar_destino_agregar").ej2_instances[0];
                    var descripcion_agregar = document.getElementById("descripcion_agregar").ej2_instances[0];

                    var nave_agregar = document.getElementById("nave_agregar").ej2_instances[0];
                    var commodity_agregar = document.getElementById("commodity_agregar").ej2_instances[0];
                    var naviera_agregar = document.getElementById("naviera_agregar").ej2_instances[0];
                    var setpoint_co2_agregar = document.getElementById("setpoint_co2_agregar").ej2_instances[0];
                    var setpoint_temp_agregar = document.getElementById("setpoint_temp_agregar").ej2_instances[0];
                    //var sensores_agregar = document.getElementById("sensores_agregar").ej2_instances[0];
                    //var numero_serie_agregar = document.getElementById("numero_serie_agregar").ej2_instances[0];
                    //var sensores_agregar2 = document.getElementById("sensores_agregar2").ej2_instances[0];
                    //var numero_serie_agregar2 = document.getElementById("numero_serie_agregar2").ej2_instances[0];
                    //var sensores_agregar3 = document.getElementById("sensores_agregar3").ej2_instances[0];
                    //var numero_serie_agregar3 = document.getElementById("numero_serie_agregar3").ej2_instances[0];
                    //var sensores_agregar4 = document.getElementById("sensores_agregar4").ej2_instances[0];
                    //var numero_serie_agregar4 = document.getElementById("numero_serie_agregar4").ej2_instances[0];
                    //var sensores_agregar5 = document.getElementById("sensores_agregar5").ej2_instances[0];
                    //var numero_serie_agregar5 = document.getElementById("numero_serie_agregar5").ej2_instances[0];

                    //eta_agregar.value = formatDate(response.eta_string);
                    //etd_agregar.value = formatDate(response.etd_string);
                    eta_agregar.value = response.eta_string;
                    etd_agregar.value = response.etd_string;
                    booking_agregar.value = response.booking;
                    origen_agregar.value = response.lugar_origen;
                    destino_agregar.value = response.lugar_destino;


                    nave_agregar.value = response.nave;
                    commodity_agregar.value = response.commodity;
                    naviera_agregar.value = response.naviera;
                    setpoint_co2_agregar.va
                    lue = response.setpoint_co2;
                    setpoint_temp_agregar.value = response.setpoint_temp;
                    descripcion_agregar.value = response.descripcion;
                    //sensores_agregar.text = response.tipo_sensor1;
                    //numero_serie_agregar.text = response.numero_sensor1;
                    //sensores_agregar2.text = response.tipo_sensor2;
                    //numero_serie_agregar2.text = response.numero_sensor2;
                    //sensores_agregar3.text = response.tipo_sensor3;
                    //numero_serie_agregar3.text = response.numero_sensor3;
                    //sensores_agregar4.text = response.tipo_sensor4;
                    //numero_serie_agregar4.text = response.numero_sensor4;
                    //sensores_agregar5.text = response.tipo_sensor5;
                    //numero_serie_agregar5.text = response.numero_sensor5;
                }
                else {
                    document.getElementById('servicio_app_servicios_agregar').value = 0;

                    var titulo = '¡Contenedor válido!';
                    if (lang === 'en') {
                        titulo = 'Valid container!';
                    }

                    Swal.fire({
                        icon: 'success',
                        title: titulo,
                        showConfirmButton: false,
                        timer: 2000
                    });
                    return false;
                }
            }
        });
    }

    function onfilteringLugarOrigen_agregar(e) {
        var lugar_origen_agregar = document.getElementById('lugar_origen_agregar').ej2_instances[0];
        var query = new ej.data.Query();
        query = (e.text !== '') ? query.where('Name', 'startswith', e.text, true) : query;
        e.updateData(lugar_origen_agregar.dataSource, query);

        if (document.getElementById('nodata-lugarorigen_agregar')) {
            document.getElementById('btn-lugarorigen_agregar').onclick = function () {
                var customValue = (document.getElementById('lugar_origen_agregar')).value;
                var newItem = { 'Name': customValue, 'Code': customValue };
                (lugar_origen_agregar.dataSource).push(newItem);
                lugar_origen_agregar.hidePopup();
                lugar_origen_agregar.addItem(newItem);
                lugar_origen_agregar.value = customValue;
            };
        }
    }

    function onfilteringLugarDestino_agregar(e) {
        var lugar_destino_agregar = document.getElementById('lugar_destino_agregar').ej2_instances[0];
        var query = new ej.data.Query();
        query = (e.text !== '') ? query.where('Name', 'startswith', e.text, true) : query;
        e.updateData(lugar_destino_agregar.dataSource, query);

        if (document.getElementById('nodata-lugardestino_agregar')) {
            document.getElementById('btn-lugardestino_agregar').onclick = function () {
                var customValue = (document.getElementById('lugar_destino_agregar')).value;
                var newItem = { 'Name': customValue, 'Code': customValue };
                (lugar_destino_agregar.dataSource).push(newItem);
                lugar_destino_agregar.hidePopup();
                lugar_destino_agregar.addItem(newItem);
                lugar_destino_agregar.value = customValue;
            };
        }
    }

    function onfilteringCommodity_agregar(e) {
        var commodity_agregar = document.getElementById('commodity_agregar').ej2_instances[0];
        var query = new ej.data.Query();
        query = (e.text !== '') ? query.where('Name', 'startswith', e.text, true) : query;
        e.updateData(commodity_agregar.dataSource, query);

        if (document.getElementById('nodata-commodity_agregar')) {
            document.getElementById('btn-commodity_agregar').onclick = function () {
                var customValue = (document.getElementById('commodity_agregar')).value;
                var newItem = { 'Name': customValue, 'Code': customValue };
                (commodity_agregar.dataSource).push(newItem);
                commodity_agregar.hidePopup();
                commodity_agregar.addItem(newItem);
                commodity_agregar.value = customValue;
            };
        }
    }

    function onfilteringSetpointCO2_agregar(e) {
        var setpoint_co2_agregar = document.getElementById('setpoint_co2_agregar').ej2_instances[0];
        var query = new ej.data.Query();
        query = (e.text !== '') ? query.where('Name', 'startswith', e.text, true) : query;
        e.updateData(setpoint_co2_agregar.dataSource, query);

        if (document.getElementById('nodata-setpoint-co2_agregar')) {
            document.getElementById('btn-setpoint-co2_agregar').onclick = function () {
                var customValue = (document.getElementById('setpoint_co2_agregar')).value;
                var newItem = { 'Name': customValue, 'Code': customValue };
                (setpoint_co2_agregar.dataSource).push(newItem);
                setpoint_co2_agregar.hidePopup();
                setpoint_co2_agregar.addItem(newItem);
                setpoint_co2_agregar.value = customValue;
            };
        }
    }

    function onfilteringSetpointTemp_agregar(e) {
        var setpoint_temp_agregar = document.getElementById('setpoint_temp_agregar').ej2_instances[0];
        var query = new ej.data.Query();
        query = (e.text !== '') ? query.where('Name', 'startswith', e.text, true) : query;
        e.updateData(setpoint_temp_agregar.dataSource, query);

        if (document.getElementById('nodata-setpoint-tem_agregarp')) {
            document.getElementById('btn-setpoint-temp_agregar').onclick = function () {
                var customValue = (document.getElementById('setpoint_temp_agregar')).value;
                var newItem = { 'Name': customValue, 'Code': customValue };
                (setpoint_temp_agregar.dataSource).push(newItem);
                setpoint_temp_agregar.hidePopup();
                setpoint_temp_agregar.addItem(newItem);
                setpoint_temp_agregar.value = customValue;
            };
        }
    }







    var boton_guardar_agregar = document.getElementById('btn-guardar_agregar');
    boton_guardar_agregar.addEventListener("click", function () {
        var contenedor_agregar = document.getElementById('contenedor_agregar').ej2_instances[0];
        var origen_agregar = document.getElementById("lugar_origen_agregar").ej2_instances[0];
        var destino_agregar = document.getElementById("lugar_destino_agregar").ej2_instances[0];
        var etd_agregar = document.getElementById("etd_agregar").ej2_instances[0];
        var eta_agregar = document.getElementById("eta_agregar").ej2_instances[0];
        var numero_serie_agregar = document.getElementById("numero_serie_agregar").ej2_instances[0];
        var sensores_agregar = document.getElementById("sensores_agregar").ej2_instances[0];

        var seleccionado = findSelection("Seleccion");

        if (contenedor_agregar.value == "" || origen_agregar.value == "" || destino_agregar.value == "" || etd_agregar.value == null || eta_agregar.value == null || (seleccionado == "SI" && (numero_serie_agregar.value == "" || sensores_agregar.value==""))) {

            if (contenedor_agregar.value == "") {
                $("#contenedor_agregar").css("border", "1px solid red");
            }
            if (origen_agregar.value == "") {
                $("#lugar_origen_agregar").css("border", "1px solid red");
            }
            if (destino_agregar.value == "") {
                $("#lugar_destino_agregar").css("border", "1px solid red");
            }
            if (etd_agregar.value == null) {
                var div_etd_agregar = document.getElementById("div-etd_agregar").childNodes;
                div_etd_agregar[1].style.borderColor = "red";
            }
            if (eta_agregar.value == null) {
                var div_eta_agregar = document.getElementById("div-eta_agregar").childNodes;
                div_eta_agregar[1].style.borderColor = "red";
            }

            if (seleccionado == "SI" && numero_serie_agregar.value == "") {
                $("#numero_serie_agregar").css("border", "1px solid red");
            }

            if (seleccionado == "SI" && sensores_agregar.value == null) {
                $("#sensores_agregar").css("border", "1px solid red");
            }

            var texto = '¡Faltan algunos campos obligatorios!';
            if (lang === 'en') {
                texto = '¡Some mandatory fields are missing!';
            }

            Swal.fire({
                icon: 'error',
                title: 'Oops...',
                text: texto,
            });
        }
        else {
            var titulo = '¿Seguro que deseas guardar el servicio?';
            var boton1 = 'Sí';
            var boton2 = 'No';
            if (lang === 'en') {
                titulo = 'Are you sure you want to save the service?';
                boton1 = 'Yes';
                boton2 = 'No';
            }

            Swal.fire({
                title: titulo,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: boton1,
                cancelButtonText: boton2
            }).then((result) => {
                if (result.value) {
                    document.getElementById('form_agregar').submit();
                }
            });
        }
    });



    var boton_editar_agregar = document.getElementById('btn-editar_agregar');
    boton_editar_agregar.addEventListener("click", function ()
    {
        var destinatario = document.getElementById('destinatario').ej2_instances[0];
        if (destinatario.value == null || destinatario.value == '') destinatario.value = 0;
        var contenedor_agregar = document.getElementById('contenedor_agregar').ej2_instances[0];
        var origen_agregar = document.getElementById("lugar_origen_agregar").ej2_instances[0];
        var destino_agregar = document.getElementById("lugar_destino_agregar").ej2_instances[0];
        var etd_agregar = document.getElementById("etd_agregar").ej2_instances[0];
        var eta_agregar = document.getElementById("eta_agregar").ej2_instances[0];
        var booking_agregar = document.getElementById("booking_agregar").ej2_instances[0];
        var nave_agregar = document.getElementById("nave_agregar").ej2_instances[0];
        var commodity_agregar = document.getElementById("commodity_agregar").ej2_instances[0];
        var naviera_agregar = document.getElementById("naviera_agregar").ej2_instances[0];
        var setpoint_co2_agregar = document.getElementById("setpoint_co2_agregar").ej2_instances[0];
        var setpoint_temp_agregar = document.getElementById("setpoint_temp_agregar").ej2_instances[0];
        var descripcion_agregar = document.getElementById("descripcion_agregar").ej2_instances[0];
        var sensores_agregar = document.getElementById("sensores_agregar").ej2_instances[0];
        var numero_serie_agregar = document.getElementById("numero_serie_agregar").ej2_instances[0];
        var sensores_agregar2 = document.getElementById("sensores_agregar2").ej2_instances[0];
        var numero_serie_agregar2 = document.getElementById("numero_serie_agregar2").ej2_instances[0];
        var sensores_agregar3 = document.getElementById("sensores_agregar3").ej2_instances[0];
        var numero_serie_agregar3 = document.getElementById("numero_serie_agregar3").ej2_instances[0];
        var sensores_agregar4 = document.getElementById("sensores_agregar4").ej2_instances[0];
        var numero_serie_agregar4 = document.getElementById("numero_serie_agregar4").ej2_instances[0];
        var sensores_agregar5 = document.getElementById("sensores_agregar5").ej2_instances[0];
        var numero_serie_agregar5 = document.getElementById("numero_serie_agregar5").ej2_instances[0];

        var seleccionado = findSelection("Seleccion");

        //console.log('paso: ' + destinatario.value);

        if (contenedor_agregar.value == "" || origen_agregar.value == "" || destino_agregar.value == "" || etd_agregar.value == null || eta_agregar.value == null || (seleccionado == "SI" && (numero_serie_agregar.value == "" || sensores_agregar.value == ""))) {

            if (contenedor_agregar.value == "") {
                $("#contenedor_agregar").css("border", "1px solid red");
            }
            if (origen_agregar.value == "") {
                $("#lugar_origen_agregar").css("border", "1px solid red");
            }
            if (destino_agregar.value == "") {
                $("#lugar_destino_agregar").css("border", "1px solid red");
            }
            if (etd_agregar.value == null) {
                var div_etd_agregar = document.getElementById("div-etd_agregar").childNodes;
                div_etd_agregar[1].style.borderColor = "red";
            }
            if (eta_agregar.value == null) {
                var div_eta_agregar = document.getElementById("div-eta_agregar").childNodes;
                div_eta_agregar[1].style.borderColor = "red";
            }

            if (seleccionado == "SI" && numero_serie_agregar.value == "") {
                $("#numero_serie_agregar").css("border", "1px solid red");
            }

            if (seleccionado == "SI" && sensores_agregar.value == null) {
                $("#sensores_agregar").css("border", "1px solid red");
            }

            var texto = '¡Faltan algunos campos obligatorios!';
            if (lang === 'en') {
                texto = '¡Some mandatory fields are missing!';
            }

            Swal.fire({
                icon: 'error',
                title: 'Oops...',
                text: texto,
            });
        }
        else {
            var titulo = '¿Seguro que deseas editar el servicio?';
            var boton1 = 'Sí';
            var boton2 = 'No';
            if (lang === 'en') {
                titulo = 'Are you sure you want to edit the service?';
                boton1 = 'Yes';
                boton2 = 'No';
            }

            Swal.fire({
                title: titulo,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: boton1,
                cancelButtonText: boton2
            }).then((result) => {
                if (result.value) {

                    $.ajax({
                        type: "POST",
                        url: '@Url.Action("EditarServicio", "Servicio")',
                        dataType: 'json',
                        data: {
                            destinatario: destinatario.value,
                            contenedor: contenedor_agregar.value,
                            origen: origen_agregar.value,
                            destino: destino_agregar.value,
                            etd: etd_agregar.previousElementValue,
                            eta: eta_agregar.previousElementValue,
                            booking: booking_agregar.value,
                            nave: nave_agregar.value,
                            commodity: commodity_agregar.value,
                            naviera: naviera_agregar.value,
                            setpoint_co2: setpoint_co2_agregar.value,
                            setpoint_temp: setpoint_temp_agregar.value,
                            descripcion: descripcion_agregar.value,
                            tipo_sensor1: sensores_agregar.text,
                            numero_sensor1: numero_serie_agregar.value,
                            tipo_sensor2: sensores_agregar2.text,
                            numero_sensor2: numero_serie_agregar2.value,
                            tipo_sensor3: sensores_agregar3.text,
                            numero_sensor3: numero_serie_agregar3.value,
                            tipo_sensor4: sensores_agregar4.text,
                            numero_sensor4: numero_serie_agregar4.value,
                            tipo_sensor5: sensores_agregar5.text,
                            numero_sensor5: numero_serie_agregar5.value
                        },
                        success: function (response) {
                            var texto0 = 'Los cambios se han guardado exitosamente.';
                            var texto0_2 = 'Los cambios se han guardado exitosamente.';
                            var texto1 = 'Los cambios se han guardado exitosamente.';
                            var texto1_2 = 'Los cambios se han guardado exitosamente.';
                            var texto2 = 'Los cambios se han guardado exitosamente.';
                            var texto2_2 = 'Los cambios se han guardado exitosamente.';
                            var contador0 = 0;
                            var contador1 = 0;
                            var contador2 = 0;

                            $.each(response, function (indice, valor) {

                                if (valor.Existe == 0) {
                                    contador0 = contador0 + 1;
                                    if (contador0 == 1) {
                                        texto0 = 'El sensor ' + valor.tipo_sensor + ' - ' + valor.numSerie + ' se eliminó exitosamente.';
                                        texto0_2 = 'Los sensores: \n' + valor.tipo_sensor + ' - ' + valor.numSerie;
                                    }
                                    else {
                                        texto0_2 = texto0_2 + '\n' + valor.tipo_sensor + ' - ' + valor.numSerie;
                                    }
                                }
                                else if (valor.Existe == 1) {
                                    contador1 = contador1 + 1;
                                    if (contador1 == 1) {
                                        texto1 = 'El sensor ' + valor.tipo_sensor + ' - ' + valor.numSerie + ' se guardó exitosamente.';
                                        texto1_2 = 'Los sensores: \n' + valor.tipo_sensor + ' - ' + valor.numSerie;
                                    }
                                    else {
                                        texto1_2 = texto1_2 + '\n' + valor.tipo_sensor + ' - ' + valor.numSerie;
                                    }
                                }
                                else if (valor.Existe == 2) {
                                    contador2 = contador2 + 1;
                                    if (contador2 == 1) {
                                        texto2 = 'El sensor ' + valor.tipo_sensor + ' - ' + valor.numSerie + ' no pudo ser guardado con éxito ya que no se encuentra activo en los registros de Emerson.';
                                        texto2_2 = 'Los sensores: \n' + valor.tipo_sensor + ' - ' + valor.numSerie;
                                    }
                                    else {
                                        texto2_2 = texto2_2 + '\n' + valor.tipo_sensor + ' - ' + valor.numSerie;
                                    }
                                }

                                if (contador0 > 1) {
                                    texto0_2 = 'se eliminaron exitosamente.';
                                }
                                if (contador1 > 1) {
                                    texto0_2 = 'se guardaron exitosamente.';
                                }
                                if (contador2 > 1) {
                                    texto0_2 = 'no lograron ser guardados con éxito ya que no se encuentran activos en los registros de Emerson.';
                                }
                            });


                            var titulo = '¡Muy Bien!';
                            var icono = 'success';
                            if (contador0 > 0 || contador2 > 0) {
                                titulo = '¡Algo anda mal!';
                                icono = 'error';
                            }

                            var texto_final = '';
                            if (contador0 > 0) {
                                if (contador0 == 1) {
                                    texto_final = texto_final + texto0;
                                }
                                else {
                                    texto_final = texto_final + texto0_2;
                                }
                            }
                            if (contador1 > 0) {
                                if (contador1 == 1) {
                                    texto_final = texto_final + texto1;
                                }
                                else {
                                    texto_final = texto_final + texto1_2;
                                }
                            }
                            if (contador2 > 0) {
                                if (contador2 == 1) {
                                    texto_final = texto_final + texto2;
                                }
                                else {
                                    texto_final = texto_final + texto2_2;
                                }
                            }

                            /*if (lang === 'en') {
                                titulo1 = '¡Very Well!';
                                texto1 = 'The changes have been saved successfully.';
                            }*/

                            Swal.fire({
                                icon: icono,
                                title: titulo,
                                text: texto_final,
                            });


                        }
                    });

                }
            });
        }
    });



    $("#AgregarViaje").click(function () {
        function formatDate(date) {
            if (date != null) {
                var fecha = date.substring(0, 10);
                var dia = date.substring(0, 2);
                var mes = date.substring(3, 5);
                var ano = date.substring(6, 10);
                return dia + "/" + mes + "/" + ano;
            } else {
                return "";
            }
        }

        $('#AgregarViajeTrigger').trigger('click');
    });

    function LlenarCamposSensores() {
        var sensores_agregar = document.getElementById("sensores_agregar").ej2_instances[0];
        var numero_serie_agregar = document.getElementById("numero_serie_agregar").ej2_instances[0];
        var sensores_agregar2 = document.getElementById("sensores_agregar2").ej2_instances[0];
        var numero_serie_agregar2 = document.getElementById("numero_serie_agregar2").ej2_instances[0];
        var sensores_agregar3 = document.getElementById("sensores_agregar3").ej2_instances[0];
        var numero_serie_agregar3 = document.getElementById("numero_serie_agregar3").ej2_instances[0];
        var sensores_agregar4 = document.getElementById("sensores_agregar4").ej2_instances[0];
        var numero_serie_agregar4 = document.getElementById("numero_serie_agregar4").ej2_instances[0];
        var sensores_agregar5 = document.getElementById("sensores_agregar5").ej2_instances[0];
        var numero_serie_agregar5 = document.getElementById("numero_serie_agregar5").ej2_instances[0];

        $("#div_sensores1").hide();
        sensores_agregar.text = '';
        numero_serie_agregar.value = '';

        $("#div_sensores2").hide();
        sensores_agregar2.text = '';
        numero_serie_agregar2.value = '';

        $("#div_sensores3").hide();
        sensores_agregar3.text = '';
        numero_serie_agregar3.value = '';

        $("#div_sensores4").hide();
        sensores_agregar4.text = '';
        numero_serie_agregar4.value = '';

        $("#div_sensores5").hide();
        sensores_agregar5.text = '';
        numero_serie_agregar5.value = '';

        $.ajax({
            type: "POST",
            url: '@Url.Action("ObtenerSensoresServicioPorContenedor", "Servicio")',
            dataType: 'json',
            data: {
                Contenedor: $("#contenedor_agregar").val(),
            },
            async: false,
            success: function (response) {
                if (response.length > 0) {

                    document.getElementById('servicio_app_servicios_agregar').value = 1;

                    if (response[0] != null) {
                        $("#div_sensores1").show();
                        sensores_agregar.text = response[0].tipo_sensor;
                        numero_serie_agregar.value = response[0].numSerie;
                        sensores_agregar.enabled = true;
                        numero_serie_agregar.enabled = true;
                        sensores_agregar.dataBind();
                        numero_serie_agregar.dataBind();
                    }
                    if (response[1] != null) {
                        $("#div_sensores2").show();
                        sensores_agregar2.text = response[1].tipo_sensor;
                        numero_serie_agregar2.value = response[1].numSerie;
                        sensores_agregar2.enabled = true;
                        numero_serie_agregar2.enabled = true;
                        sensores_agregar2.dataBind();
                        numero_serie_agregar2.dataBind();
                    }
                    if (response[2] != null) {
                        $("#div_sensores3").show();
                        sensores_agregar3.text = response[2].tipo_sensor;
                        numero_serie_agregar3.value = response[2].numSerie;
                        sensores_agregar3.enabled = true;
                        numero_serie_agregar3.enabled = true;
                        sensores_agregar3.dataBind();
                        numero_serie_agregar3.dataBind();
                    }
                    if (response[3] != null) {
                        $("#div_sensores4").show();
                        sensores_agregar4.text = response[3].tipo_sensor;
                        numero_serie_agregar4.value = response[3].numSerie;
                        sensores_agregar4.enabled = true;
                        numero_serie_agregar4.enabled = true;
                        sensores_agregar4.dataBind();
                        numero_serie_agregar4.dataBind();
                    }
                    if (response[4] != null) {
                        $("#div_sensores5").show();
                        sensores_agregar5.text = response[4].tipo_sensor;
                        numero_serie_agregar5.value = response[4].numSerie;
                        sensores_agregar5.enabled = true;
                        numero_serie_agregar5.enabled = true;
                        sensores_agregar5.dataBind();
                        numero_serie_agregar5.dataBind();
                    }
                }
            }
        });
    }

</script>

<style>
    .eimg {
        border-radius: 10%;
        padding: 10px 16px;
        width: 100px;
        height: 60px;
        float: left;
    }

    .ename {
        font-weight: bold;
        display: block !important;
        opacity: .87;
    }

    .image_sensor1 {
        background-image: url("https://ej2.syncfusion.com/demos/src/grid/images/3.png");
        border-radius: 50%;
        padding: 10px 16px;
        width: 40px;
        height: 40px;
        float: left;
    }

    .image_sensor2 {
        background-image: url("https://ej2.syncfusion.com/demos/src/grid/images/3.png");
        border-radius: 50%;
        padding: 10px 16px;
        width: 40px;
        height: 40px;
        float: left;
    }

    .image_sensor3 {
        background-image: url("https://ej2.syncfusion.com/demos/src/grid/images/3.png");
        border-radius: 50%;
        padding: 10px 16px;
        width: 40px;
        height: 40px;
        float: left;
    }

    .image_sensor4 {
        background-image: url("https://ej2.syncfusion.com/demos/src/grid/images/3.png");
        border-radius: 50%;
        padding: 10px 16px;
        width: 40px;
        height: 40px;
        float: left;
    }

    .image_sensor5 {
        background-image: url("https://ej2.syncfusion.com/demos/src/grid/images/3.png");
        border-radius: 50%;
        padding: 10px 16px;
        width: 40px;
        height: 40px;
        float: left;
    }

    .div-row {
        padding-bottom: 15px;
    }

    .invalid {
        border: 1px solid red !important;
    }

    .e-card {
        font-family: Gotham Medium !important;
    }

    .e-tab {
        font-family: Gotham Medium !important;
    }

    .e-tab-text {
        font-family: Gotham Medium !important;
    }

    .e-control {
        font-family: Gotham Medium !important;
    }

    .e-treeview.e-list-text {
        color: white !important;
        font-family: Gotham Medium !important;
    }

    .e-float-text {
        font-family: Gotham Medium !important;
    }

    p {
        margin: 0 0 0px;
        margin-bottom: 0px;
    }

    .h4 {
        color: black !important;
        font-family: Gotham Medium !important;
    }

    .h5 {
        color: black !important;
        font-family: Gotham Medium !important;
    }

    .main-content {
        background: #F7F7F7 !important;
        font-family: Gotham Medium !important;
    }

    #Emptext {
        top: -12px;
        left: 41px;
        position: relative;
    }

    .e-grid.e-rtl #Emptext {
        top: -12px;
        left: -41px;
        position: relative;
    }

    .empimg {
        height: 27px;
        width: 29px;
        border-radius: 14px;
    }

    .gm-style-iw {
        height: 95px;
        width: 60%;
        padding-left: 20px;
        margin-left: 40px;
        float: left;
        line-height: 25px;
    }


    td.e-rowcell.e-selectionbackground.e-active {
        background-color: transparent;
    }

    .e-hightheme td.e-rowcell.e-selectionbackground.e-active {
        background-color: transparent;
        color: white;
    }

    .e-bigger .e-grid .statustxt {
        position: relative;
        top: -2px;
    }

    .rating .star {
        font-size: 132%;
        color: lightgrey;
    }

        .rating .star.checked {
            color: #ffa600;
        }

    td.e-rowcell .statustxt.e-activecolor {
        color: #00cc00;
        position: relative;
        top: 9px;
    }

    td.e-rowcell .statustxt.e-inactivecolor {
        color: #e60000;
        position: relative;
        top: 9px;
    }

    .statustemp.e-inactivecolor {
        background-color: #ffd7cc;
    }

    .statustemp.e-activecolor {
        background-color: #ccffcc;
    }

    .statustxt.e-activecolor {
        color: #00cc00;
    }

    .statustxt.e-inactivecolor {
        color: #e60000;
    }

    #Trusttext {
        position: relative;
        top: 1px;
    }

    .e-image {
        height: 13px;
        width: 14px;
    }

    .statustemp.e-inactivecolor {
        width: 64px;
    }

    .statustemp.e-activecolor {
        width: 57px;
    }

    .statustemp {
        position: relative;
        height: 19px;
        border-radius: 5px;
        text-align: center;
    }

    .highcontrast #msg {
        color: #FFFFFF;
    }


    #msg {
        font-family: "Segoe UI", "GeezaPro", "DejaVu Serif", sans-serif;
        font-size: 14px;
        font-weight: 400;
        opacity: 0.95;
        color: #333;
        float: right;
        margin-top: 3px;
    }

    @@media only screen and (max-width: 370px) {
        #msg {
            float: left;
            margin-top: 3px;
        }

        #GridOverview {
            margin-top: 36px;
        }
    }

    #samplecontainer {
        padding-top: 5px;
    }

    #myProgress {
        position: relative;
        height: 18px;
        width: 10em;
        text-align: left;
        background-color: white;
    }

    .highcontrast .e-grid #myProgress {
        background-color: black;
    }

    #myBar {
        position: absolute;
        width: 10%;
        height: 100%;
        background-color: #00b300;
    }

        #myBar.progressdisable {
            background-color: #df2222;
        }

    #label {
        position: relative;
        left: 10px;
        line-height: 18px;
        font-size: 10px;
        color: white;
    }
</style>
<style>
    .pac-container {
        z-index: 10000 !important;
    }
</style>